#!/bin/sh



BASEPATH=`dirname $0`

if [ "$2" = "" ] ; then 
    echo "Converts binary file to object file which can be linked to the executable as resource"
    echo ""
    cat "$BASEPATH/LICENSE"
    echo ""
    echo "Usage: $0 <file> <identifier> [<output>] [<header file>]"
    echo ""
    echo "<file>          source file (binary)"
    echo "<identifier>    name of global identifier under which the file is accessible"
    echo "                  identifier is in type const char *"
    echo "                  program also creates <identifier>_length of type unsigned int"
    echo "                  which contains length of the file"
    echo "<output>          optional name of output file. Default is \"<file>.o\""
    echo "<header file>     optional name of output header file. Default is \"<file>.h\""
    echo ""
    echo "Source: https://github.com/ondra-novak/bin2c"
    exit 1
fi


set -e

OUTPUT=$3
HEADER=$4

if [ "$3" = "" ] ; then 
    OUTPUT="$1.o"
fi

if [ "$4" = "" ] ; then
    HEADER="$1.h"
fi


make -s -C "$BASEPATH/src" all

$BASEPATH/src/bin2c "$1" "$2" | gcc -c -o "$OUTPUT" -xc -Wall -Wno-trigraphs -

echo "/* Generated by bin2o from the file: \"$1\" */" > "$HEADER"
echo "extern const char *$2;" >> "$HEADER"
echo "extern unsigned int ${2}_length;" >> "$HEADER"

